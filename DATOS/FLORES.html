<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="icon" href="img/flowers.png" type="image/x-icon" />
  <title>FLORES</title>

  <style>
    /* Estilos mínimos para el botón de reproducción (puedes moverlos a css/main.css) */
    .music-toggle {
      position: fixed;
      left: 18px;
      bottom: 18px;
      z-index: 9999;
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #ffd3a6, #ff8fb1);
      color: #08101b;
      font-weight: 700;
      box-shadow: 0 8px 30px rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: transform .15s ease;
    }
    .music-toggle:hover { transform: translateY(-3px); }
    .music-toggle:focus { outline: 3px solid rgba(255,255,255,0.12); outline-offset:4px; }

    /* Ocultar el botón por defecto en pantallas grandes (si autoplay funciona en PC no hace falta) */
    @media (min-width:900px){
      .music-toggle { display: none; }
    }
  </style>
</head>

<body class="container">
  <!-- Audio controlado por JS (usa varias fuentes y playsinline para móviles) -->
  <audio id="bg-music" loop preload="auto" playsinline>
    <!-- rutas: ajusta si tu mp3 está en otra carpeta -->
    <source src="DATOS/audio/Floricienta.mp3" type="audio/mpeg">
    <source src="/DATOS/img/Floricienta.mp3" type="audio/mpeg"> <!-- fallback a la ruta que tenías -->
    <source src="DATOS/audio/Floricienta.m4a" type="audio/mp4">
    Tu navegador no soporta el elemento de audio.
  </audio>

  <!-- Botón Play/Pause: aparece si la reproducción automática falla en el navegador -->
  <button id="music-toggle" class="music-toggle" aria-pressed="false" aria-label="Reproducir música" title="Reproducir música">▶︎</button>

  <div class="night"></div>

  <div class="flowers">
    <div class="flower flower--1">
      <div class="flower__leafs flower__leafs--1">
        <div class="flower__leaf flower__leaf--1"></div>
        <div class="flower__leaf flower__leaf--2"></div>
        <div class="flower__leaf flower__leaf--3"></div>
        <div class="flower__leaf flower__leaf--4"></div>
        <div class="flower__white-circle"></div>

        <div class="flower__light flower__light--1"></div>
        <div class="flower__light flower__light--2"></div>
        <div class="flower__light flower__light--3"></div>
        <div class="flower__light flower__light--4"></div>
        <div class="flower__light flower__light--5"></div>
        <div class="flower__light flower__light--6"></div>
        <div class="flower__light flower__light--7"></div>
        <div class="flower__light flower__light--8"></div>
      </div>
      <div class="flower__line">
        <div class="flower__line__leaf flower__line__leaf--1"></div>
        <div class="flower__line__leaf flower__line__leaf--2"></div>
        <div class="flower__line__leaf flower__line__leaf--3"></div>
        <div class="flower__line__leaf flower__line__leaf--4"></div>
        <div class="flower__line__leaf flower__line__leaf--5"></div>
        <div class="flower__line__leaf flower__line__leaf--6"></div>
      </div>
    </div>

    <div class="flower flower--2">
      <div class="flower__leafs flower__leafs--2">
        <div class="flower__leaf flower__leaf--1"></div>
        <div class="flower__leaf flower__leaf--2"></div>
        <div class="flower__leaf flower__leaf--3"></div>
        <div class="flower__leaf flower__leaf--4"></div>
        <div class="flower__white-circle"></div>

        <div class="flower__light flower__light--1"></div>
        <div class="flower__light flower__light--2"></div>
        <div class="flower__light flower__light--3"></div>
        <div class="flower__light flower__light--4"></div>
        <div class="flower__light flower__light--5"></div>
        <div class="flower__light flower__light--6"></div>
        <div class="flower__light flower__light--7"></div>
        <div class="flower__light flower__light--8"></div>
      </div>
      <div class="flower__line">
        <div class="flower__line__leaf flower__line__leaf--1"></div>
        <div class="flower__line__leaf flower__line__leaf--2"></div>
        <div class="flower__line__leaf flower__line__leaf--3"></div>
        <div class="flower__line__leaf flower__line__leaf--4"></div>
      </div>
    </div>

    <div class="flower flower--3">
      <div class="flower__leafs flower__leafs--3">
        <div class="flower__leaf flower__leaf--1"></div>
        <div class="flower__leaf flower__leaf--2"></div>
        <div class="flower__leaf flower__leaf--3"></div>
        <div class="flower__leaf flower__leaf--4"></div>
        <div class="flower__white-circle"></div>

        <div class="flower__light flower__light--1"></div>
        <div class="flower__light flower__light--2"></div>
        <div class="flower__light flower__light--3"></div>
        <div class="flower__light flower__light--4"></div>
        <div class="flower__light flower__light--5"></div>
        <div class="flower__light flower__light--6"></div>
        <div class="flower__light flower__light--7"></div>
        <div class="flower__light flower__light--8"></div>
      </div>
      <div class="flower__line">
        <div class="flower__line__leaf flower__line__leaf--1"></div>
        <div class="flower__line__leaf flower__line__leaf--2"></div>
        <div class="flower__line__leaf flower__line__leaf--3"></div>
        <div class="flower__line__leaf flower__line__leaf--4"></div>
      </div>
    </div>

    <div class="flower flower--4">
      <div class="flower__leafs flower__leafs--4">
        <div class="flower__leaf flower__leaf--1"></div>
        <div class="flower__leaf flower__leaf--2"></div>
        <div class="flower__leaf flower__leaf--3"></div>
        <div class="flower__leaf flower__leaf--4"></div>
        <div class="flower__white-circle"></div>

        <div class="flower__light flower__light--1"></div>
        <div class="flower__light flower__light--2"></div>
        <div class="flower__light flower__light--3"></div>
        <div class="flower__light flower__light--4"></div>
        <div class="flower__light flower__light--5"></div>
        <div class="flower__light flower__light--6"></div>
        <div class="flower__light flower__light--7"></div>
        <div class="flower__light flower__light--8"></div>
      </div>
      <div class="flower__line">
        <div class="flower__line__leaf flower__line__leaf--1"></div>
        <div class="flower__line__leaf flower__line__leaf--2"></div>
        <div class="flower__line__leaf flower__line__leaf--3"></div>
        <div class="flower__line__leaf flower__line__leaf--4"></div>
      </div>
    </div>

    <div class="grow-ans" style="--d:1.2s">
      <div class="flower__g-long">
        <div class="flower__g-long__top"></div>
        <div class="flower__g-long__bottom"></div>
      </div>
    </div>

    <div class="growing-grass">
      <div class="flower__grass flower__grass--1">
        <div class="flower__grass--top"></div>
        <div class="flower__grass--bottom"></div>
        <div class="flower__grass__leaf flower__grass__leaf--1"></div>
        <div class="flower__grass__leaf flower__grass__leaf--2"></div>
        <div class="flower__grass__leaf flower__grass__leaf--3"></div>
        <div class="flower__grass__leaf flower__grass__leaf--4"></div>
        <div class="flower__grass__leaf flower__grass__leaf--5"></div>
        <div class="flower__grass__leaf flower__grass__leaf--6"></div>
        <div class="flower__grass__leaf flower__grass__leaf--7"></div>
        <div class="flower__grass__leaf flower__grass__leaf--8"></div>
        <div class="flower__grass__overlay"></div>
      </div>
    </div>

    <div class="grow-ans" style="--d:3.2s">
      <div class="flower__g-fr">
        <div class="leaf"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--1"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--2"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--3"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--4"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--5"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--6"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--7"></div>
        <div class="flower__g-fr__leaf flower__g-fr__leaf--8"></div>
      </div>
    </div>

    <div class="long-g long-g--0">
      <div class="grow-ans" style="--d:3s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:2.2s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:3.4s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--1">
      <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:3.8s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:4s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:4.2s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--2">
      <div class="grow-ans" style="--d:4s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:4.2s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:4.4s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:4.6s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--3">
      <div class="grow-ans" style="--d:4s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:4.2s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:3s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--4">
      <div class="grow-ans" style="--d:4s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:4.2s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:3s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--5">
      <div class="grow-ans" style="--d:4s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:4.2s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:3s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--6">
      <div class="grow-ans" style="--d:4.2s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:4.4s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:4.6s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:4.8s"><div class="leaf leaf--3"></div></div>
    </div>

    <div class="long-g long-g--7">
      <div class="grow-ans" style="--d:3s"><div class="leaf leaf--0"></div></div>
      <div class="grow-ans" style="--d:3.2s"><div class="leaf leaf--1"></div></div>
      <div class="grow-ans" style="--d:3.5s"><div class="leaf leaf--2"></div></div>
      <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--3"></div></div>
    </div>
  </div>

  <!-- Script: intenta autoplay en PC y desbloquea en móvil con interacción; muestra botón si falla -->
  <script>
    (function () {
      const audio = document.getElementById('bg-music');
      const btn = document.getElementById('music-toggle');

      function setPlayingUI(isPlaying) {
        if (!btn) return;
        btn.textContent = isPlaying ? '❚❚' : '▶︎';
        btn.setAttribute('aria-pressed', String(isPlaying));
        btn.setAttribute('aria-label', isPlaying ? 'Pausar música' : 'Reproducir música');
      }

      async function tryPlayAudio() {
        if (!audio) return false;
        try {
          await audio.play();
          setPlayingUI(true);
          try { localStorage.setItem('audio_unlocked', '1'); } catch (e) {}
          // hide toggle if it's visible
          if (btn) btn.style.display = 'none';
          return true;
        } catch (err) {
          // autoplay blocked -> show button so the user can start playback manually
          setPlayingUI(false);
          if (btn) btn.style.display = '';
          return false;
        }
      }

      // unlock on first user gesture (some mobile browsers require a user gesture)
      function unlockOnce() {
        tryPlayAudio();
        window.removeEventListener('pointerdown', unlockOnce);
        window.removeEventListener('touchstart', unlockOnce);
      }

      // Button toggle logic
      if (btn) {
        // keep it hidden by default on wide screens; JS shows it if autoplay is blocked
        btn.style.display = 'none';
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          if (!audio) return;
          if (audio.paused) {
            audio.play().then(() => {
              setPlayingUI(true);
              try { localStorage.setItem('audio_unlocked', '1'); } catch (e) {}
              // hide button on success for desktop; on mobile you may want to keep it visible
              // keep hidden to match behavior requested (autoplay on PC, button on mobile)
              if (window.innerWidth >= 900) btn.style.display = 'none';
            }).catch(() => setPlayingUI(false));
          } else {
            audio.pause();
            setPlayingUI(false);
            try { localStorage.removeItem('audio_unlocked'); } catch (e) {}
            btn.style.display = '';
          }
        });
      }

      // On load try autoplay (this will typically work on desktop)
      window.addEventListener('load', () => {
        // If the user previously unlocked audio on this device, try again
        const prev = (function () { try { return localStorage.getItem('audio_unlocked'); } catch (e) { return null; } })();
        if (prev && audio) {
          tryPlayAudio();
        } else {
          // optimistic attempt for desktop
          tryPlayAudio();
        }

        // attach gesture listeners to unlock audio on mobile if autoplay was blocked
        window.addEventListener('pointerdown', unlockOnce, { passive: true });
        window.addEventListener('touchstart', unlockOnce, { passive: true });
      });
    })();
  </script>

  <script src="main.js"></script>
</body>
</html>